<VirtualHost *:80>
  RewriteEngine On
  RewriteCond %{HTTPS} off
  RewriteRule ^ https://%{HTTP_HOST}:443%{REQUEST_URI} [R=302,L,QSA]
</VirtualHost>

<VirtualHost *:443>

  DocumentRoot /var/www/html

  RedirectMatch ^/$ /registry/

  ErrorLog ${APACHE_LOG_DIR}/error.log
  CustomLog ${APACHE_LOG_DIR}/access.log combined

  LogLevel warn

  Header always set Strict-Transport-Security "max-age=63072000; includeSubDomains"

  SSLEngine on
  SSLProtocol all -SSLv2 -SSLv3
  SSLCipherSuite EECDH+AESGCM:EDH+AESGCM:AES256+EECDH:AES256+EDH
  SSLHonorCipherOrder on

  SSLCertificateFile /etc/apache2/cert.pem
  SSLCertificateKeyFile /etc/apache2/privkey.pem
  SSLCertificateChainFile /etc/apache2/chain.pem
  
  <Directory /var/www/html/registry>
    Options Indexes FollowSymLinks
    DirectoryIndex index.php
    AllowOverride All
    Require all granted
  </Directory>

  <Directory /var/www/html/registry/auth/login>
    AuthType Basic
    AuthName "COmanage Registry Login"
    AuthBasicProvider file
    AuthUserFile "/etc/apache2/passwords"
    Require valid-user
  </Directory>

</VirtualHost>
